<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Mock Test</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .highlight {
            background-color: yellow;
            padding: 1px 2px;
        }
        
        .passage-container {
            max-height: 70vh;
            overflow-y: auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .answer-sheet {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .answer-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .answer-input:focus {
            border-color: #0d6efd;
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        .answer-input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        
        .timer {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .timer.warning {
            color: #dc3545 !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            padding: 0;
            min-width: 120px;
        }
        
        .context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }
        
        .context-menu-item:hover {
            background-color: #f8f9fa;
        }
        
        .question-number {
            font-weight: bold;
            color: #0d6efd;
            margin-right: 8px;
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.3rem;
        }
        
        .time-up-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .time-up-message {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .editable-passage {
            min-height: 300px;
            line-height: 1.6;
            user-select: text;
        }
        
        .editable-passage[contenteditable="false"] {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
        }
        
        .editable-passage[contenteditable="true"] {
            background-color: #fff3cd;
            border: 2px dashed #ffc107;
        }
        
        .section-title {
            color: #495057;
            font-weight: 600;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand">IELTS Reading Mock Test</span>
            <div class="d-flex align-items-center">
                <span class="text-light me-3">Time Remaining:</span>
                <span id="timer" class="timer text-light">60:00</span>
                <button id="lockBtn" class="btn btn-outline-warning btn-sm ms-3">🔓 Unlock Edit</button>
                <button id="resetBtn" class="btn btn-outline-light btn-sm ms-3">Reset Test</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Column - Passage -->
            <div class="col-lg-7">
                <div class="card">
                    <div class="card-header">
                        <h5 class="section-title mb-0">Reading Passage</h5>
                        <small id="editHint" class="text-muted">Right-click on text to highlight</small>
                    </div>
                    <div class="card-body">
                        <div id="passage" class="passage-container editable-passage" contenteditable="false">
                            <h4>The History of Coffee</h4>
                            <p>Coffee is one of the world's most popular beverages, consumed by billions of people daily. The story of coffee begins in ancient Ethiopia, where legend tells us that a goat herder named Kaldi discovered the energizing effects of coffee beans around the 9th century. According to the tale, Kaldi noticed his goats becoming unusually energetic after eating certain red berries from a particular tree.</p>

                            <p>From Ethiopia, coffee spread to Yemen in the 15th century, where Sufi monks used it to stay alert during long prayer sessions. The port city of Mocha became a major trading center, giving its name to the famous coffee variety. Coffee houses, known as "schools of the wise," began appearing throughout the Ottoman Empire, serving as centers for social activity, intellectual discourse, and political debate.</p>

                            <p>European merchants introduced coffee to Venice in the early 17th century, despite initial resistance from the Catholic Church, which called it "Satan's drink." However, Pope Clement VIII reportedly blessed coffee, leading to its acceptance throughout Christian Europe. Coffee houses quickly spread across major European cities, becoming important social and commercial hubs.</p>

                            <p>The Dutch established coffee plantations in Ceylon (now Sri Lanka) and Java, breaking the Arabian monopoly on coffee production. This expansion led to the development of different coffee varieties and brewing methods. The French introduced coffee to the Caribbean, while the British established plantations in Jamaica and other colonies.</p>

                            <p>The industrial revolution brought significant changes to coffee production and consumption. The invention of the espresso machine in Italy revolutionized coffee preparation, while instant coffee, developed in the early 20th century, made coffee more convenient for mass consumption. Today, coffee is the world's second-most traded commodity after oil, supporting millions of farmers worldwide and continuing to evolve with new brewing techniques and flavor profiles.</p>

                            <h5>Questions 1-10</h5>
                            <p><strong>Complete the sentences below using NO MORE THAN TWO WORDS from the passage.</strong></p>

                            <ol>
                                <li>According to legend, coffee was discovered by a _______ _______ named Kaldi.</li>
                                <li>Kaldi noticed his goats became energetic after eating _______ _______.</li>
                                <li>In Yemen, _______ _______ used coffee to stay alert during prayers.</li>
                                <li>The port city of _______ became a major trading center for coffee.</li>
                                <li>Coffee houses in the Ottoman Empire were called "_______ of the _______."</li>
                                <li>The Catholic Church initially called coffee "_______'s drink."</li>
                                <li>Pope _______ _______ reportedly blessed coffee.</li>
                                <li>The Dutch broke the _______ _______ on coffee production.</li>
                                <li>The _______ _______ brought changes to coffee production.</li>
                                <li>Coffee is now the world's _______-most traded commodity.</li>
                            </ol>

                            <h5>Questions 11-20</h5>
                            <p><strong>Choose the correct answer A, B, C, or D.</strong></p>

                            <ol start="11">
                                <li>When did coffee reportedly spread from Ethiopia to Yemen?
                                    <br>A) 9th century B) 15th century C) 17th century D) 20th century</li>
                                <li>What role did coffee houses play in the Ottoman Empire?
                                    <br>A) Religious ceremonies B) Military meetings C) Social and intellectual centers D) Trade negotiations only</li>
                                <li>How did coffee first reach Europe?
                                    <br>A) Through French traders B) Via Dutch merchants C) Through Venetian merchants D) By British explorers</li>
                                <li>What was the Catholic Church's initial reaction to coffee?
                                    <br>A) Immediate acceptance B) Complete indifference C) Strong resistance D) Cautious approval</li>
                                <li>Which country established coffee plantations in Java?
                                    <br>A) France B) Britain C) Spain D) Netherlands</li>
                            </ol>

                            <h5>Questions 21-30</h5>
                            <p><strong>True/False/Not Given questions.</strong></p>

                            <ol start="21">
                                <li>Kaldi was a goat herder in ancient Ethiopia.</li>
                                <li>Coffee was first used for religious purposes in Yemen.</li>
                                <li>Venice was the first European city to import coffee.</li>
                                <li>All European churches initially opposed coffee.</li>
                                <li>The Dutch were the first Europeans to establish coffee plantations.</li>
                                <li>Coffee production was limited to Arabia until the 17th century.</li>
                                <li>The espresso machine was invented during the industrial revolution.</li>
                                <li>Instant coffee was developed in the 19th century.</li>
                                <li>Coffee is currently the most traded commodity in the world.</li>
                                <li>Modern coffee continues to evolve with new brewing methods.</li>
                            </ol>

                            <h5>Questions 31-40</h5>
                            <p><strong>Complete the summary using words from the passage.</strong></p>

                            <p>Coffee's journey from ancient Ethiopia to global commodity demonstrates remarkable cultural and economic development. Initially discovered by a (31) _______ in Ethiopia, coffee spread to Yemen where (32) _______ used it for religious purposes. The beverage faced initial (33) _______ from the Catholic Church but gained acceptance after papal (34) _______. European colonial powers established (35) _______ in various regions, breaking Arabian control over production. The (36) _______ revolution introduced mechanization, including the (37) _______ machine and (38) _______ coffee for mass consumption. Today, coffee supports millions of (39) _______ worldwide and remains the second-most (40) _______ commodity globally.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Answer Sheet -->
            <div class="col-lg-5">
                <div class="card">
                    <div class="card-header">
                        <h5 class="section-title mb-0">Answer Sheet</h5>
                        <small class="text-muted">Answers auto-save as you type</small>
                    </div>
                    <div class="card-body">
                        <div class="answer-sheet">
                            <div class="row" id="answerGrid">
                                <!-- Answer inputs will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Context Menu -->
    <div id="contextMenu" class="context-menu" style="display: none;">
        <button class="context-menu-item" id="highlightOption">Highlight Text</button>
    </div>

    <!-- Time Up Overlay -->
    <div id="timeUpOverlay" class="time-up-overlay" style="display: none;">
        <div class="time-up-message">
            <h2 class="text-danger">⏰ Time's Up!</h2>
            <p>Your test has ended. All answers have been locked.</p>
            <button class="btn btn-primary" onclick="location.reload()">Start New Test</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        class IELTSMockTest {
            constructor() {
                this.timeLeft = 60 * 60; // 60 minutes in seconds
                this.timer = null;
                this.isTestActive = true;
                this.isEditLocked = true;
                this.selectedText = null;
                this.selectedRange = null;
                
                this.init();
            }

            init() {
                this.generateAnswerInputs();
                this.startTimer();
                this.setupEventListeners();
                this.loadSavedAnswers();
            }

            generateAnswerInputs() {
                const answerGrid = document.getElementById('answerGrid');
                let html = '';
                
                for (let i = 1; i <= 40; i++) {
                    html += `
                        <div class="col-md-6 mb-3">
                            <div class="d-flex align-items-center">
                                <span class="question-number">${i}.</span>
                                <input type="text" 
                                       class="answer-input" 
                                       id="answer${i}" 
                                       data-question="${i}"
                                       placeholder="Your answer..."
                                       maxlength="50">
                            </div>
                        </div>
                    `;
                }
                
                answerGrid.innerHTML = html;
            }

            setupEventListeners() {
                // Answer input auto-save
                document.addEventListener('input', (e) => {
                    if (e.target.classList.contains('answer-input')) {
                        this.saveAnswer(e.target.dataset.question, e.target.value);
                    }
                });

                // Reset button
                document.getElementById('resetBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to reset the test? This will clear all answers and restart the timer.')) {
                        this.resetTest();
                    }
                });

                // Lock/Unlock button
                document.getElementById('lockBtn').addEventListener('click', () => {
                    this.toggleEditLock();
                });

                // Right-click context menu for highlighting
                const passage = document.getElementById('passage');
                
                passage.addEventListener('contextmenu', (e) => {
                    // Only show highlight menu if edit is locked (test mode)
                    if (!this.isEditLocked) {
                        return; // Allow default context menu in edit mode
                    }
                    
                    e.preventDefault();
                    
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0 && !selection.isCollapsed) {
                        this.selectedText = selection.toString();
                        this.selectedRange = selection.getRangeAt(0);
                        
                        this.showContextMenu(e.clientX, e.clientY);
                    } else {
                        this.hideContextMenu();
                    }
                });

                // Hide context menu on click elsewhere
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#contextMenu')) {
                        this.hideContextMenu();
                    }
                });

                // Highlight option click
                document.getElementById('highlightOption').addEventListener('click', () => {
                    this.highlightSelectedText();
                    this.hideContextMenu();
                });

                // Prevent context menu on answer sheet
                document.querySelector('.answer-sheet').addEventListener('contextmenu', (e) => {
                    // Allow default browser context menu for answer inputs
                });
            }

            startTimer() {
                const timerDisplay = document.getElementById('timer');
                
                // Clear any existing timer first
                if (this.timer) {
                    clearInterval(this.timer);
                }
                
                this.timer = setInterval(() => {
                    if (!this.isTestActive) return;
                    
                    this.timeLeft--;
                    
                    const minutes = Math.floor(this.timeLeft / 60);
                    const seconds = this.timeLeft % 60;
                    
                    timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Turn red in last 10 minutes
                    if (this.timeLeft <= 600) {
                        timerDisplay.classList.add('warning');
                    }
                    
                    // Time up
                    if (this.timeLeft <= 0) {
                        this.endTest();
                    }
                }, 1000);
            }

            endTest() {
                this.isTestActive = false;
                clearInterval(this.timer);
                
                // Lock all inputs
                const inputs = document.querySelectorAll('.answer-input');
                inputs.forEach(input => input.disabled = true);
                
                // Show time up overlay
                document.getElementById('timeUpOverlay').style.display = 'flex';
            }

            resetTest() {
                // Clear timer
                if (this.timer) {
                    clearInterval(this.timer);
                }
                
                // Reset time and state
                this.timeLeft = 60 * 60;
                this.isTestActive = true;
                
                // Reset timer display
                const timerDisplay = document.getElementById('timer');
                timerDisplay.textContent = '60:00';
                timerDisplay.classList.remove('warning');
                
                // Clear all answers
                const inputs = document.querySelectorAll('.answer-input');
                inputs.forEach(input => {
                    input.value = '';
                    input.disabled = false;
                });
                
                // Clear localStorage
                for (let i = 1; i <= 40; i++) {
                    localStorage.removeItem(`ielts_answer_${i}`);
                }
                
                // Remove all highlights
                const highlights = document.querySelectorAll('.highlight');
                highlights.forEach(highlight => {
                    const parent = highlight.parentNode;
                    if (parent) {
                        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                        parent.normalize();
                    }
                });
                
                // Hide time up overlay
                const timeUpOverlay = document.getElementById('timeUpOverlay');
                if (timeUpOverlay) {
                    timeUpOverlay.style.display = 'none';
                }
                
                // Reset to locked mode if currently unlocked
                if (!this.isEditLocked) {
                    this.toggleEditLock();
                }
                
                // Hide context menu if open
                this.hideContextMenu();
                
                // Restart timer
                this.startTimer();
                
                console.log('Test reset successfully');
            }

            toggleEditLock() {
                const passage = document.getElementById('passage');
                const lockBtn = document.getElementById('lockBtn');
                const editHint = document.getElementById('editHint');
                
                this.isEditLocked = !this.isEditLocked;
                
                if (this.isEditLocked) {
                    // Lock editing (test mode)
                    passage.contentEditable = 'false';
                    lockBtn.innerHTML = '🔓 Unlock Edit';
                    lockBtn.className = 'btn btn-outline-warning btn-sm ms-3';
                    editHint.textContent = 'Right-click on text to highlight';
                } else {
                    // Unlock editing (edit mode)
                    passage.contentEditable = 'true';
                    lockBtn.innerHTML = '🔒 Lock Edit';
                    lockBtn.className = 'btn btn-outline-success btn-sm ms-3';
                    editHint.textContent = 'Click to edit passage and questions';
                    passage.focus();
                }
            }

            saveAnswer(questionNum, answer) {
                localStorage.setItem(`ielts_answer_${questionNum}`, answer);
            }

            loadSavedAnswers() {
                for (let i = 1; i <= 40; i++) {
                    const savedAnswer = localStorage.getItem(`ielts_answer_${i}`);
                    if (savedAnswer) {
                        const input = document.getElementById(`answer${i}`);
                        if (input) input.value = savedAnswer;
                    }
                }
            }

            showContextMenu(x, y) {
                const contextMenu = document.getElementById('contextMenu');
                contextMenu.style.display = 'block';
                contextMenu.style.left = x + 'px';
                contextMenu.style.top = y + 'px';
            }

            hideContextMenu() {
                document.getElementById('contextMenu').style.display = 'none';
            }

            highlightSelectedText() {
                if (!this.selectedRange) return;
                
                try {
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    
                    // Extract the selected content and wrap it
                    const contents = this.selectedRange.extractContents();
                    span.appendChild(contents);
                    
                    // Insert the highlighted span
                    this.selectedRange.insertNode(span);
                    
                    // Clear selection
                    window.getSelection().removeAllRanges();
                    
                } catch (error) {
                    console.error('Error highlighting text:', error);
                }
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new IELTSMockTest();
        });

        // Prevent accidental page unload
        window.addEventListener('beforeunload', (e) => {
            e.preventDefault();
            e.returnValue = '';
        });
    </script>
</body>
</html>
